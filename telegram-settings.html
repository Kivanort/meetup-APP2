<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–∏–≤—è–∑–∫–∞ Telegram ‚Äî MeetUP</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="icon" href="meetup-logo.png" type="image/x-icon"> 
    <script src="userSystem.js"></script>
    <style>
        :root {
            --bg-main: #121212;
            --card-bg: rgba(30,30,30,0.95);
            --border: #333;
            --border-active: #00FFFF;
            --text-main: #FFF;
            --text-muted: #888;
            --gradient-primary: linear-gradient(135deg, #00FFFF, #9400D3);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: var(--bg-main);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 480px;
        }
        
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(36,36,36,0.9);
            border: none;
            border-radius: 50%;
            width: 46px;
            height: 46px;
            display: flex;
                align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.2s;
        }
        
        .back-btn:hover {
            background: #2a2a2a;
            transform: translateY(-2px);
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
        }
        
        .title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-align: center;
        }
        
        .subtitle {
            color: var(--text-muted);
            text-align: center;
            margin-bottom: 32px;
            font-size: 16px;
        }
        
        .telegram-icon {
            text-align: center;
            margin-bottom: 24px;
        }
        
        .telegram-icon .material-icons {
            font-size: 64px;
            color: #0088cc;
            background: rgba(0, 136, 204, 0.1);
            padding: 20px;
            border-radius: 50%;
        }
        
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.2s;
            margin-top: 16px;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 255, 255, 0.3);
        }
        
        .btn-telegram {
            background: #0088cc;
            color: white;
        }
        
        .btn-telegram:hover {
            background: #0077b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 136, 204, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.05);
            color: var(--text-main);
            border: 1px solid var(--border);
        }
        
        .btn-secondary:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .status-message {
            padding: 12px;
            border-radius: 8px;
            margin: 16px 0;
            display: none;
            align-items: center;
            gap: 10px;
            animation: fadeIn 0.3s;
        }
        
        .status-message.success {
            background: rgba(0, 200, 83, 0.1);
            border-left: 4px solid #00C853;
            color: #00C853;
        }
        
        .status-message.error {
            background: rgba(255, 68, 68, 0.1);
            border-left: 4px solid #FF4444;
            color: #FF4444;
        }
        
        .status-message.info {
            background: rgba(0, 136, 204, 0.1);
            border-left: 4px solid #0088cc;
            color: #0088cc;
        }
        
        .timer {
            text-align: center;
            color: var(--text-muted);
            font-size: 14px;
            margin: 16px 0;
            font-variant-numeric: tabular-nums;
        }
        
        .code-inputs {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 24px 0;
        }
        
        .code-input {
            width: 50px;
            height: 60px;
            text-align: center;
            font-size: 24px;
            font-weight: 600;
            background: rgba(255,255,255,0.05);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--text-main);
        }
        
        .code-input:focus {
            border-color: var(--border-active);
            outline: none;
        }
        
        .user-info {
            background: rgba(0, 136, 204, 0.1);
            border-radius: 12px;
            padding: 16px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .user-avatar {
            width: 60px;
            height: 60px;
            background: #0088cc;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
        }
        
        .user-details {
            flex: 1;
        }
        
        .user-name {
            font-weight: 600;
            font-size: 18px;
        }
        
        .user-username {
            color: var(--text-muted);
            font-size: 14px;
        }
        
        .verified-badge {
            background: #00C853;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .instructions {
            background: rgba(0, 136, 204, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #0088cc;
        }
        
        .instructions ol {
            margin-left: 20px;
            margin-top: 10px;
        }
        
        .instructions li {
            margin-bottom: 8px;
            color: var(--text-muted);
        }
        
        .qr-container {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
        }
        
        .qr-code {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            background: white;
            padding: 10px;
            border-radius: 8px;
        }
        
        .deep-link {
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 136, 204, 0.1);
            border-radius: 12px;
            border: 2px dashed #0088cc;
            text-align: center;
            word-break: break-all;
            font-family: monospace;
            font-size: 14px;
            color: #00FFFF;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @media (max-width: 480px) {
            .card {
                padding: 24px;
            }
            
            .title {
                font-size: 24px;
            }
            
            .code-input {
                width: 44px;
                height: 56px;
            }
            
            .qr-code {
                width: 160px;
                height: 160px;
            }
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="window.location.href='profile.html'">
        <span class="material-icons">arrow_back</span>
    </button>
    
    <div class="container">
        <div class="card">
            <div class="telegram-icon">
                <span class="material-icons">telegram</span>
            </div>
            
            <h1 class="title">–ü—Ä–∏–≤—è–∑–∫–∞ Telegram</h1>
            <p class="subtitle">–ü–æ–ª—É—á–∞–π—Ç–µ –∫–æ–¥—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏ —Å–±—Ä–∞—Å—ã–≤–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å —á–µ—Ä–µ–∑ Telegram</p>
            
            <!-- –®–∞–≥ 1: –ù–∞—á–∞–ª–æ –ø—Ä–∏–≤—è–∑–∫–∏ -->
            <div id="step-init">
                <div class="instructions">
                    <h3 style="margin-bottom: 10px; color: #00FFFF;">üì± –ö–∞–∫ –ø—Ä–∏–≤—è–∑–∞—Ç—å Telegram:</h3>
                    <ol>
                        <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å Telegram</li>
                        <li>–ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É <strong>–ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</strong> (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ü—Ä–∏–≤–µ—Ç")</li>
                        <li>–ë–æ—Ç –ø—Ä–∏—à–ª–µ—Ç –≤–∞–º 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥</li>
                        <li>–í–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –≤–≤–µ–¥–∏—Ç–µ –∫–æ–¥</li>
                    </ol>
                </div>
                
                <button class="btn btn-telegram" id="btn-open-telegram">
                    <span class="material-icons">send</span>
                    –û—Ç–∫—Ä—ã—Ç—å Telegram –∏ –Ω–∞–ø–∏—Å–∞—Ç—å –±–æ—Ç—É
                </button>
                
                <div style="text-align: center; margin: 20px 0; color: var(--text-muted);">
                    –ò–ª–∏ –æ—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥:
                </div>
                
                <div class="qr-container">
                    <div id="qr-code-placeholder" class="qr-code">
                        <!-- QR-–∫–æ–¥ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #f0f0f0; border-radius: 4px; color: #333; font-size: 12px; text-align: center; padding: 10px;">
                            QR-–∫–æ–¥ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-primary" id="btn-already-sent">
                    <span class="material-icons">check</span>
                    –Ø —É–∂–µ –Ω–∞–ø–∏—Å–∞–ª –±–æ—Ç—É –∏ –ø–æ–ª—É—á–∏–ª –∫–æ–¥
                </button>
            </div>
            
            <!-- –®–∞–≥ 2: –í–≤–æ–¥ –∫–æ–¥–∞ -->
            <div id="step-verification" style="display: none;">
                <div class="instructions">
                    <h3 style="margin-bottom: 10px; color: #00FFFF;">üî¢ –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ Telegram:</h3>
                    <p style="color: var(--text-muted); margin-bottom: 10px;">
                        –ë–æ—Ç @MeetUPpasswordbot –æ—Ç–ø—Ä–∞–≤–∏–ª –≤–∞–º 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥. –í–≤–µ–¥–∏—Ç–µ –µ–≥–æ –Ω–∏–∂–µ:
                    </p>
                </div>
                
                <div class="code-inputs">
                    <input type="text" class="code-input" id="code-1" maxlength="1" inputmode="numeric" autocomplete="off">
                    <input type="text" class="code-input" id="code-2" maxlength="1" inputmode="numeric" autocomplete="off">
                    <input type="text" class="code-input" id="code-3" maxlength="1" inputmode="numeric" autocomplete="off">
                    <input type="text" class="code-input" id="code-4" maxlength="1" inputmode="numeric" autocomplete="off">
                    <input type="text" class="code-input" id="code-5" maxlength="1" inputmode="numeric" autocomplete="off">
                    <input type="text" class="code-input" id="code-6" maxlength="1" inputmode="numeric" autocomplete="off">
                </div>
                
                <div class="timer" id="verification-timer">
                    –ö–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω: <span id="timer-display">10:00</span>
                </div>
                
                <button class="btn btn-primary" id="btn-verify-code">
                    <span class="material-icons">check_circle</span>
                    –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∫–æ–¥
                </button>
                
                <button class="btn btn-secondary" id="btn-back-to-start">
                    <span class="material-icons">arrow_back</span>
                    –ù–∞–∑–∞–¥
                </button>
            </div>
            
            <!-- –®–∞–≥ 3: –£—Å–ø–µ—à–Ω–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ -->
            <div id="step-success" style="display: none;">
                <div style="text-align: center; margin: 32px 0;">
                    <div style="width: 80px; height: 80px; background: #00C853; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px;">
                        <span class="material-icons" style="font-size: 40px; color: white;">check</span>
                    </div>
                    <h2 style="margin-bottom: 12px; color: #00C853;">‚úÖ Telegram —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω!</h2>
                    <p style="color: var(--text-muted); margin-bottom: 32px;">
                        –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Telegram –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è –∏ –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                    </p>
                </div>
                
                <div class="user-info">
                    <div class="user-avatar">
                        <span class="material-icons">telegram</span>
                    </div>
                    <div class="user-details">
                        <div class="user-name">Telegram –∞–∫–∫–∞—É–Ω—Ç</div>
                        <div class="user-username">–ü—Ä–∏–≤—è–∑–∞–Ω –∫ MeetUP</div>
                        <div style="margin-top: 8px;">
                            <span class="verified-badge">
                                <span class="material-icons" style="font-size: 14px;">verified</span>
                                –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ
                            </span>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 32px;">
                    <button class="btn btn-primary" onclick="window.location.href='profile.html'">
                        <span class="material-icons">arrow_back</span>
                        –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª—å
                    </button>
                </div>
            </div>
            
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ–º –∞–∫–∫–∞—É–Ω—Ç–µ -->
            <div id="already-bound" style="display: none;">
                <div style="text-align: center; margin: 20px 0;">
                    <div style="width: 60px; height: 60px; background: #00C853; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px;">
                        <span class="material-icons" style="font-size: 30px; color: white;">check</span>
                    </div>
                    <h3 style="margin-bottom: 8px; color: #00C853;">Telegram —É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω</h3>
                </div>
                
                <div class="user-info">
                    <div class="user-avatar">
                        <span class="material-icons">telegram</span>
                    </div>
                    <div class="user-details">
                        <div class="user-name" id="existing-telegram-name">Telegram –∞–∫–∫–∞—É–Ω—Ç</div>
                        <div class="user-username" id="existing-telegram-username"></div>
                        <div style="margin-top: 8px;">
                            <span class="verified-badge" id="existing-verified-badge">
                                <span class="material-icons" style="font-size: 14px;">verified</span>
                                –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ
                            </span>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 24px;">
                    <button class="btn btn-secondary" id="btn-unbind-telegram">
                        <span class="material-icons">link_off</span>
                        –û—Ç–≤—è–∑–∞—Ç—å Telegram
                    </button>
                    
                    <button class="btn btn-primary" onclick="window.location.href='profile.html'">
                        <span class="material-icons">arrow_back</span>
                        –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª—å
                    </button>
                </div>
            </div>
            
            <!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö/—É—Å–ø–µ—Ö–µ -->
            <div class="status-message" id="status-message"></div>
        </div>
    </div>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è QR-–∫–æ–¥–∞ -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentStep = 'init';
        let verificationTimer = null;
        let timeLeft = 600; // 10 –º–∏–Ω—É—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
        let generatedCode = '';
        let botUsername = 'MeetUPpasswordbot'; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π username –±–æ—Ç–∞
        
        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const elements = {
            stepInit: document.getElementById('step-init'),
            stepVerification: document.getElementById('step-verification'),
            stepSuccess: document.getElementById('step-success'),
            alreadyBound: document.getElementById('already-bound'),
            statusMessage: document.getElementById('status-message'),
            codeInputs: [
                document.getElementById('code-1'),
                document.getElementById('code-2'),
                document.getElementById('code-3'),
                document.getElementById('code-4'),
                document.getElementById('code-5'),
                document.getElementById('code-6')
            ],
            timerDisplay: document.getElementById('timer-display'),
            existingTelegramName: document.getElementById('existing-telegram-name'),
            existingTelegramUsername: document.getElementById('existing-telegram-username'),
            existingVerifiedBadge: document.getElementById('existing-verified-badge'),
            qrCodePlaceholder: document.getElementById('qr-code-placeholder')
        };
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å UI
        function showStatus(type, message) {
            elements.statusMessage.className = `status-message ${type}`;
            elements.statusMessage.innerHTML = `
                <span class="material-icons">${type === 'success' ? 'check_circle' : type === 'error' ? 'error' : 'info'}</span>
                <span>${message}</span>
            `;
            elements.statusMessage.style.display = 'flex';
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            if (type !== 'error') {
                setTimeout(() => {
                    elements.statusMessage.style.display = 'none';
                }, 5000);
            }
        }
        
        function showStep(stepName) {
            currentStep = stepName;
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —à–∞–≥–∏
            elements.stepInit.style.display = 'none';
            elements.stepVerification.style.display = 'none';
            elements.stepSuccess.style.display = 'none';
            elements.alreadyBound.style.display = 'none';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π —à–∞–≥
            switch(stepName) {
                case 'init':
                    elements.stepInit.style.display = 'block';
                    break;
                case 'verification':
                    elements.stepVerification.style.display = 'block';
                    break;
                case 'success':
                    elements.stepSuccess.style.display = 'block';
                    break;
                case 'alreadyBound':
                    elements.alreadyBound.style.display = 'block';
                    break;
            }
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        function generateVerificationCode() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }
        
        // –¢–∞–π–º–µ—Ä –¥–ª—è –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        function startVerificationTimer() {
            clearInterval(verificationTimer);
            timeLeft = 600; // 10 –º–∏–Ω—É—Ç
            
            updateTimerDisplay();
            
            verificationTimer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(verificationTimer);
                    showStatus('error', '–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∫–æ–¥–∞ –∏—Å—Ç–µ–∫. –ù–∞—á–Ω–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–Ω–æ–≤–æ.');
                    showStep('init');
                }
            }, 1000);
        }
        
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            elements.timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (timeLeft < 60) {
                elements.timerDisplay.style.color = '#FF4444';
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ –∫–æ–¥–∞
        function setupCodeInputs() {
            elements.codeInputs.forEach((input, index) => {
                if (!input) return;
                
                input.addEventListener('input', (e) => {
                    const value = e.target.value;
                    
                    // –û—á–∏—â–∞–µ–º –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã
                    if (value && !/^\d$/.test(value)) {
                        e.target.value = '';
                        return;
                    }
                    
                    // –ê–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–æ–ª—é
                    if (value.length === 1 && index < elements.codeInputs.length - 1) {
                        elements.codeInputs[index + 1].focus();
                    }
                    
                    // –ê–≤—Ç–æ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –≤—Å–µ—Ö –ø–æ–ª–µ–π
                    if (index === elements.codeInputs.length - 1 && value.length === 1) {
                        const allFilled = elements.codeInputs.every(input => input.value.length === 1);
                        if (allFilled) {
                            document.getElementById('btn-verify-code').focus();
                        }
                    }
                });
                
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && e.target.value.length === 0 && index > 0) {
                        elements.codeInputs[index - 1].focus();
                    }
                });
                
                input.addEventListener('paste', (e) => {
                    e.preventDefault();
                    const pasteData = e.clipboardData.getData('text').replace(/\D/g, '');
                    
                    if (pasteData.length === 6) {
                        elements.codeInputs.forEach((input, i) => {
                            input.value = pasteData[i] || '';
                        });
                        document.getElementById('btn-verify-code').focus();
                    }
                });
            });
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è deep link
        function generateDeepLink() {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userId = UserSystem.getCurrentUser()?.id || 'demo';
            const timestamp = Date.now();
            const uniqueCode = btoa(`${userId}:${timestamp}`).replace(/=/g, '').substring(0, 16);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–¥ –≤ localStorage
            localStorage.setItem('telegram_auth_code', uniqueCode);
            localStorage.setItem('telegram_auth_timestamp', timestamp.toString());
            
            // –°–æ–∑–¥–∞–µ–º deep link
            const deepLink = `https://t.me/${botUsername}?start=${uniqueCode}`;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º QR-–∫–æ–¥
            QRCode.toCanvas(deepLink, { 
                width: 180, 
                height: 180,
                margin: 1,
                color: {
                    dark: '#000000',
                    light: '#FFFFFF'
                }
            }, function(error, canvas) {
                if (error) {
                    console.error('QR code error:', error);
                    elements.qrCodePlaceholder.innerHTML = `
                        <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #f0f0f0; border-radius: 4px; color: #333; font-size: 12px; text-align: center; padding: 10px;">
                            –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞<br>
                            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Å—ã–ª–∫—É:<br>
                            t.me/${botUsername}
                        </div>
                    `;
                } else {
                    elements.qrCodePlaceholder.innerHTML = '';
                    elements.qrCodePlaceholder.appendChild(canvas);
                }
            });
            
            return deepLink;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø—Ä–∏–≤—è–∑–∫–∏
        function checkExistingBinding() {
            const currentUser = UserSystem.getCurrentUser();
            if (!currentUser) {
                window.location.href = 'index.html';
                return;
            }
            
            if (currentUser.telegram) {
                elements.existingTelegramUsername.textContent = currentUser.telegram.username ? `@${currentUser.telegram.username}` : 'Telegram –∞–∫–∫–∞—É–Ω—Ç';
                
                if (currentUser.telegram.verified) {
                    elements.existingVerifiedBadge.innerHTML = `
                        <span class="material-icons" style="font-size: 14px;">verified</span>
                        –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ
                    `;
                    elements.existingVerifiedBadge.style.background = '#00C853';
                } else {
                    elements.existingVerifiedBadge.innerHTML = `
                        <span class="material-icons" style="font-size: 14px;">schedule</span>
                        –û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                    `;
                    elements.existingVerifiedBadge.style.background = '#FF9800';
                }
                
                showStep('alreadyBound');
            } else {
                showStep('init');
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º QR-–∫–æ–¥ —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
                setTimeout(() => {
                    generateDeepLink();
                }, 500);
            }
        }
        
        // –û—Å–Ω–æ–≤–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.getElementById('btn-open-telegram').addEventListener('click', function() {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º deep link
            const deepLink = generateDeepLink();
            
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º Telegram
            window.open(deepLink, '_blank');
            
            showStatus('info', 'Telegram –æ—Ç–∫—Ä—ã—Ç. –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø–æ–ª—É—á–∏—Ç–µ –∫–æ–¥.');
            
            // –ß–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –≤–≤–µ—Å—Ç–∏ –∫–æ–¥
            setTimeout(() => {
                showStep('verification');
                startVerificationTimer();
                
                // –§–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤–æ–µ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∫–æ–¥–∞
                setTimeout(() => {
                    elements.codeInputs[0].focus();
                }, 100);
            }, 2000);
        });
        
        document.getElementById('btn-already-sent').addEventListener('click', function() {
            generatedCode = generateVerificationCode();
            
            // –î–ª—è –¥–µ–º–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–¥
            showStatus('info', `–î–ª—è –¥–µ–º–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–¥: ${generatedCode}`);
            
            showStep('verification');
            startVerificationTimer();
            
            // –§–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤–æ–µ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –∫–æ–¥–∞
            setTimeout(() => {
                elements.codeInputs[0].focus();
            }, 100);
        });
        
        document.getElementById('btn-verify-code').addEventListener('click', function() {
            const code = elements.codeInputs.map(input => input.value).join('');
            
            if (code.length !== 6) {
                showStatus('error', '–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω—ã–π –∫–æ–¥ –∏–∑ 6 —Ü–∏—Ñ—Ä');
                return;
            }
            
            this.disabled = true;
            this.innerHTML = '<span class="material-icons">hourglass_empty</span> –ü—Ä–æ–≤–µ—Ä–∫–∞...';
            
            const currentUser = UserSystem.getCurrentUser();
            
            // –î–ª—è –¥–µ–º–æ: –ø—Ä–∏–Ω–∏–º–∞–µ–º –ª—é–±–æ–π 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
            // –í —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ —Ç—É—Ç –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ–¥ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
            const isValid = code.length === 6 && /^\d{6}$/.test(code);
            
            if (isValid) {
                clearInterval(verificationTimer);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const users = UserSystem.getUsers();
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                
                if (userIndex !== -1) {
                    // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ localStorage (–µ—Å–ª–∏ –µ—Å—Ç—å)
                    const storedCode = localStorage.getItem('telegram_auth_code');
                    
                    users[userIndex].telegram = {
                        username: storedCode ? `user_${storedCode.substring(0, 8)}` : 'telegram_user',
                        verified: true,
                        verifiedAt: new Date().toISOString(),
                        chatId: `chat_${Date.now()}`, // –í —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ —ç—Ç–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π chat_id
                        lastAuth: new Date().toISOString()
                    };
                    
                    UserSystem.saveUsers(users);
                    UserSystem.setCurrentUser(users[userIndex]);
                    
                    // –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    localStorage.removeItem('telegram_auth_code');
                    localStorage.removeItem('telegram_auth_timestamp');
                    
                    showStep('success');
                    showStatus('success', 'Telegram —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω!');
                    
                    // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞
                    elements.codeInputs.forEach(input => input.value = '');
                } else {
                    showStatus('error', '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                }
            } else {
                showStatus('error', '–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è. –ö–æ–¥ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 6 —Ü–∏—Ñ—Ä.');
            }
            
            this.disabled = false;
            this.innerHTML = '<span class="material-icons">check_circle</span> –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∫–æ–¥';
        });
        
        document.getElementById('btn-back-to-start').addEventListener('click', function() {
            showStep('init');
            elements.codeInputs.forEach(input => input.value = '');
            clearInterval(verificationTimer);
        });
        
        document.getElementById('btn-unbind-telegram').addEventListener('click', function() {
            if (confirm('–û—Ç–≤—è–∑–∞—Ç—å Telegram –∞–∫–∫–∞—É–Ω—Ç? –í—ã –±–æ–ª—å—à–µ –Ω–µ —Å–º–æ–∂–µ—Ç–µ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å —á–µ—Ä–µ–∑ Telegram.')) {
                const users = UserSystem.getUsers();
                const currentUser = UserSystem.getCurrentUser();
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                
                if (userIndex !== -1) {
                    delete users[userIndex].telegram;
                    UserSystem.saveUsers(users);
                    UserSystem.setCurrentUser(users[userIndex]);
                    
                    showStatus('success', 'Telegram –∞–∫–∫–∞—É–Ω—Ç –æ—Ç–≤—è–∑–∞–Ω');
                    setTimeout(() => {
                        checkExistingBinding();
                    }, 1000);
                }
            }
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            const currentUser = UserSystem.getCurrentUser();
            if (!currentUser) {
                window.location.href = 'index.html';
                return;
            }
            
            setupCodeInputs();
            checkExistingBinding();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∫–æ–¥ –≤ URL (–¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏–∑ Telegram)
            const urlParams = new URLSearchParams(window.location.search);
            const telegramCode = urlParams.get('code');
            
            if (telegramCode && telegramCode.length === 6) {
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –∫–æ–¥ –∏–∑ URL
                elements.codeInputs.forEach((input, index) => {
                    input.value = telegramCode[index] || '';
                });
                
                showStep('verification');
                startVerificationTimer();
                showStatus('info', '–ö–æ–¥ –∏–∑ URL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω');
            }
        });
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –±–æ—Ç–∞ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è WebApp)
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'telegram_code') {
                const code = event.data.code;
                if (code && code.length === 6) {
                    elements.codeInputs.forEach((input, index) => {
                        input.value = code[index] || '';
                    });
                    
                    if (currentStep === 'init') {
                        showStep('verification');
                        startVerificationTimer();
                    }
                    
                    showStatus('info', '–ö–æ–¥ –∏–∑ Telegram –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω');
                }
            }
        });
    </script>
</body>
</html>
