<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#121212">
  <meta name="description" content="–ö–∞—Ä—Ç–∞ –¥—Ä—É–∑–µ–π - –Ω–∞—Ö–æ–¥–∏—Ç–µ –∏ –æ—Ç–º–µ—á–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –Ω–∞ –∫–∞—Ä—Ç–µ">
  <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Äî –ö–∞—Ä—Ç–∞ –¥—Ä—É–∑–µ–π</title>
  
  <!-- PWA –º–µ—Ç–∞-—Ç–µ–≥–∏ -->
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="meetup-logo.png" type="image/x-icon">
  <link rel="apple-touch-icon" href="meetup-logo.png">
  
  <!-- Google Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ JavaScript –º–æ–¥—É–ª—è -->
  <script src="userSystem.js" defer></script>
  
  <style>
    /* CSS –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã */
    :root {
      --bg-primary: #121212;
      --bg-secondary: rgba(30, 30, 30, 0.95);
      --bg-surface: #1a1a1a;
      --text-primary: #ffffff;
      --text-secondary: #888888;
      --text-disabled: #666666;
      --border-default: #333333;
      --border-active: #00FFFF;
      --border-error: #FF4444;
      --border-success: #00C853;
      --gradient-primary: linear-gradient(135deg, #00FFFF 0%, #9400D3 100%);
      --gradient-hover: linear-gradient(135deg, #00FFFF 20%, #9400D3 100%);
      --accent-cyan: #00FFFF;
      --accent-violet: #9400D3;
      --overlay-dark: rgba(0, 0, 0, 0.7);
      --shadow-card: 0 8px 32px rgba(0, 0, 0, 0.3);
      --shadow-button: 0 4px 12px rgba(0, 255, 255, 0.2);
      --radius-large: 16px;
      --radius-medium: 12px;
      --radius-small: 8px;
      --transition-fast: 0.2s ease;
      --transition-normal: 0.3s ease;
    }
    
    /* –°–±—Ä–æ—Å —Å—Ç–∏–ª–µ–π */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    html {
      height: 100%;
      scroll-behavior: smooth;
    }
    
    body {
      min-height: 100vh;
      min-height: -webkit-fill-available;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.5;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      position: relative;
    }
    
    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ñ–æ—Ä–º—ã */
    .form-container {
      width: 100%;
      max-width: 420px;
      background: var(--bg-secondary);
      border-radius: var(--radius-large);
      padding: 32px 28px;
      box-shadow: var(--shadow-card);
      backdrop-filter: blur(10px);
      position: relative;
      z-index: 10;
    }
    
    /* –õ–æ–≥–æ—Ç–∏–ø –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ */
    .logo-section {
      text-align: center;
      margin-bottom: 32px;
    }
    
    .logo-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 16px;
      background: black;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid var(--accent-cyan);
      transition: transform var(--transition-normal);
    }
    
    .logo-icon:hover {
      transform: scale(1.05);
    }
    
    .logo-icon svg {
      width: 48px;
      height: 48px;
    }
    
    .main-title {
      font-size: 28px;
      font-weight: 700;
      margin: 0;
      background: linear-gradient(135deg, var(--accent-cyan), var(--accent-violet));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      letter-spacing: -0.5px;
    }
    
    /* –ö–Ω–æ–ø–∫–∏ */
    .btn {
      width: 100%;
      padding: 16px;
      border: none;
      border-radius: var(--radius-medium);
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: all var(--transition-fast);
      margin-bottom: 12px;
      position: relative;
      overflow: hidden;
    }
    
    .btn::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 5px;
      height: 5px;
      background: rgba(255, 255, 255, 0.5);
      opacity: 0;
      border-radius: 100%;
      transform: scale(1, 1) translate(-50%);
      transform-origin: 50% 50%;
    }
    
    .btn:active::after {
      animation: ripple 1s ease-out;
    }
    
    .btn-primary {
      background: var(--gradient-primary);
      color: white;
    }
    
    .btn-primary:hover {
      background: var(--gradient-hover);
      transform: translateY(-1px);
      box-shadow: var(--shadow-button);
    }
    
    .btn-primary:active {
      transform: translateY(0);
    }
    
    .btn-secondary {
      background: var(--bg-surface);
      color: var(--text-primary);
      border: 1px solid var(--border-default);
    }
    
    .btn-secondary:hover {
      background: #2a2a2a;
      border-color: var(--text-secondary);
    }
    
    /* –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å */
    .divider {
      display: flex;
      align-items: center;
      margin: 24px 0;
      color: var(--text-secondary);
      font-size: 14px;
    }
    
    .divider::before,
    .divider::after {
      content: "";
      flex: 1;
      height: 1px;
      background: var(--border-default);
    }
    
    .divider::before {
      margin-right: 16px;
    }
    
    .divider::after {
      margin-left: 16px;
    }
    
    /* –§–æ—Ä–º—ã */
    .form-view {
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    .form-view.active {
      display: block;
    }
    
    .form-title {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 24px;
      text-align: center;
      color: var(--text-primary);
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .input-wrapper {
      position: relative;
    }
    
    .form-input {
      width: 100%;
      padding: 16px 50px 16px 50px;
      background: var(--bg-surface);
      border: 2px solid var(--border-default);
      border-radius: var(--radius-small);
      color: var(--text-primary);
      font-size: 16px;
      transition: all var(--transition-fast);
    }
    
    .form-input:focus {
      border-color: var(--accent-cyan);
      outline: none;
      box-shadow: 0 0 0 3px rgba(0, 255, 255, 0.1);
    }
    
    .form-input::placeholder {
      color: var(--text-disabled);
    }
    
    .input-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      pointer-events: none;
    }
    
    .toggle-password {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .toggle-password:hover {
      color: var(--text-primary);
    }
    
    /* –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö/—É—Å–ø–µ—Ö–µ */
    .message {
      display: none;
      align-items: center;
      gap: 8px;
      margin-top: 8px;
      font-size: 13px;
      padding: 8px 12px;
      border-radius: var(--radius-small);
      animation: slideIn 0.3s ease;
    }
    
    .message.error {
      background: rgba(255, 68, 68, 0.1);
      color: var(--border-error);
      border-left: 3px solid var(--border-error);
    }
    
    .message.success {
      background: rgba(0, 200, 83, 0.1);
      color: var(--border-success);
      border-left: 3px solid var(--border-success);
    }
    
    /* –°—Å—ã–ª–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ö */
    .form-links {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 24px;
    }
    
    .form-link {
      color: var(--accent-cyan);
      text-decoration: none;
      text-align: center;
      font-size: 15px;
      padding: 8px;
      transition: opacity var(--transition-fast);
      position: relative;
    }
    
    .form-link:hover {
      opacity: 0.8;
    }
    
    .form-link::after {
      content: '';
      position: absolute;
      bottom: 4px;
      left: 50%;
      width: 0;
      height: 1px;
      background: var(--accent-cyan);
      transition: all var(--transition-fast);
      transform: translateX(-50%);
    }
    
    .form-link:hover::after {
      width: 80%;
    }
    
    /* –ê–≤–∞—Ç–∞—Ä */
    .avatar-section {
      display: flex;
      align-items: center;
      gap: 20px;
      margin: 24px 0;
      justify-content: center;
    }
    
    .avatar-preview {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: var(--bg-surface);
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid transparent;
      overflow: hidden;
      position: relative;
      transition: border-color var(--transition-fast);
    }
    
    .avatar-preview.has-image {
      border-color: var(--accent-cyan);
    }
    
    .avatar-preview::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, transparent, rgba(0, 255, 255, 0.1));
      opacity: 0;
      transition: opacity var(--transition-fast);
    }
    
    .avatar-preview:hover::before {
      opacity: 1;
    }
    
    .btn-avatar {
      padding: 12px 20px;
      background: var(--bg-surface);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-small);
      color: var(--text-primary);
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all var(--transition-fast);
    }
    
    .btn-avatar:hover {
      background: #2a2a2a;
      border-color: var(--accent-cyan);
    }
    
    /* –ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è */
    .code-inputs {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin: 24px 0;
    }
    
    .code-input {
      width: 52px;
      height: 64px;
      text-align: center;
      font-size: 24px;
      font-weight: 600;
      background: var(--bg-surface);
      border: 2px solid var(--border-default);
      border-radius: var(--radius-small);
      color: var(--text-primary);
      transition: all var(--transition-fast);
    }
    
    .code-input:focus {
      border-color: var(--accent-cyan);
      outline: none;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 255, 255, 0.2);
    }
    
    /* –¢–∞–π–º–µ—Ä */
    .timer {
      text-align: center;
      color: var(--text-secondary);
      font-size: 14px;
      margin: 16px 0;
      font-variant-numeric: tabular-nums;
    }
    
    .resend-btn {
      background: none;
      border: none;
      color: var(--accent-cyan);
      font-size: 14px;
      cursor: pointer;
      text-decoration: underline;
      transition: opacity var(--transition-fast);
    }
    
    .resend-btn:hover:not(:disabled) {
      opacity: 0.8;
    }
    
    .resend-btn:disabled {
      color: var(--text-disabled);
      cursor: not-allowed;
      text-decoration: none;
    }
    
    /* –î–µ–º–æ-–ø–æ–¥—Å–∫–∞–∑–∫–∞ */
    .demo-hint {
      background: rgba(0, 255, 255, 0.1);
      border: 1px solid var(--accent-cyan);
      border-radius: var(--radius-small);
      padding: 12px;
      margin: 20px 0;
      font-size: 13px;
      text-align: center;
      line-height: 1.4;
    }
    
    /* –°–ø–∏–Ω–Ω–µ—Ä */
    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--bg-surface);
      border-top: 3px solid var(--accent-cyan);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 20px auto;
      display: none;
    }
    
    /* –ö–Ω–æ–ø–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA */
    .install-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--gradient-primary);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: var(--radius-medium);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      z-index: 1000;
      box-shadow: var(--shadow-card);
      display: none;
      align-items: center;
      gap: 8px;
      transition: all var(--transition-fast);
    }
    
    .install-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 255, 255, 0.3);
    }
    
    /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-10px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @keyframes ripple {
      0% { transform: scale(0, 0); opacity: 0.5; }
      100% { transform: scale(40, 40); opacity: 0; }
    }
    
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 480px) {
      body {
        padding: 16px;
        align-items: flex-start;
        padding-top: 40px;
      }
      
      .form-container {
        padding: 24px 20px;
        border-radius: 12px;
      }
      
      .logo-icon {
        width: 64px;
        height: 64px;
      }
      
      .logo-icon svg {
        width: 36px;
        height: 36px;
      }
      
      .main-title {
        font-size: 24px;
      }
      
      .form-title {
        font-size: 22px;
      }
      
      .btn {
        padding: 14px;
        font-size: 15px;
      }
      
      .form-input {
        padding: 14px 45px 14px 45px;
        font-size: 15px;
      }
      
      .avatar-section {
        flex-direction: column;
        gap: 16px;
      }
      
      .avatar-preview {
        width: 72px;
        height: 72px;
      }
      
      .btn-avatar {
        width: 100%;
        justify-content: center;
      }
      
      .code-input {
        width: 46px;
        height: 56px;
        font-size: 22px;
      }
      
      .code-inputs {
        gap: 10px;
      }
      
      .install-btn {
        bottom: 16px;
        right: 16px;
        padding: 10px 20px;
        font-size: 13px;
      }
    }
    
    @media (max-width: 320px) {
      .form-container {
        padding: 20px 16px;
      }
      
      .code-input {
        width: 40px;
        height: 52px;
        font-size: 20px;
      }
    }
    
    /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ iOS */
    @supports (-webkit-touch-callout: none) {
      body {
        min-height: -webkit-fill-available;
      }
    }
  </style>
</head>
<body>
  <div class="form-container">
    <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div class="form-view active" id="main-view">
      <div class="logo-section">
        <div class="logo-icon">
          <svg viewBox="0 0 48 48">
            <circle cx="24" cy="24" r="24" fill="#000"/>
            <ellipse cx="24" cy="20" rx="10" ry="11" fill="#fff"/>
            <ellipse cx="24" cy="36" rx="15" ry="10" fill="#fff"/>
          </svg>
        </div>
        <h1 class="main-title">–ö–∞—Ä—Ç–∞ –¥—Ä—É–∑–µ–π</h1>
      </div>
      
      <button class="btn btn-primary" id="btn-login-view">
        <span class="material-icons">vpn_key</span>
        –í–æ–π—Ç–∏
      </button>
      
      <button class="btn btn-primary" id="btn-register-view">
        <span class="material-icons">person_add</span>
        –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
      </button>
      
      <div class="divider">–∏–ª–∏</div>
      
      <button class="btn btn-secondary" id="btn-google">
        <span style="font-weight:bold;color:#4285F4;">G</span>
        –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google
      </button>
      
      <button class="btn btn-secondary" id="btn-apple">
        <span class="material-icons">apple</span>
        –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Apple
      </button>
    </div>

    <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
    <div class="form-view" id="login-view">
      <h2 class="form-title">–í—Ö–æ–¥</h2>
      <form id="login-form">
        <div class="form-group">
          <div class="input-wrapper">
            <input type="text" class="form-input" id="login-identity" placeholder="Email –∏–ª–∏ –Ω–∏–∫–Ω–µ–π–º" required>
            <span class="material-icons input-icon">person</span>
          </div>
        </div>
        
        <div class="form-group">
          <div class="input-wrapper">
            <input type="password" class="form-input" id="login-password" placeholder="–ü–∞—Ä–æ–ª—å" required>
            <span class="material-icons input-icon">lock</span>
            <button type="button" class="toggle-password" id="toggle-login-password">
              <span class="material-icons">visibility_off</span>
            </button>
          </div>
          <div class="message error" id="login-error">
            <span class="material-icons">error</span>
            –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞
          </div>
        </div>
        
        <button type="submit" class="btn btn-primary">
          <span class="material-icons">login</span>
          –í–æ–π—Ç–∏
        </button>
      </form>
      
      <div class="form-links">
        <a href="#" class="form-link" id="link-forgot">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
        <a href="#" class="form-link" id="link-to-register">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
      </div>
    </div>

    <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div class="form-view" id="register-view">
      <h2 class="form-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
      <form id="register-form">
        <div class="form-group">
          <div class="input-wrapper">
            <input type="text" class="form-input" id="register-nickname" placeholder="–ù–∏–∫–Ω–µ–π–º" required>
            <span class="material-icons input-icon">person</span>
          </div>
          <div class="message error" id="nickname-error">
            <span class="material-icons">error</span>
            <span id="nickname-error-text"></span>
          </div>
        </div>
        
        <div class="form-group">
          <div class="input-wrapper">
            <input type="email" class="form-input" id="register-email" placeholder="Email" required>
            <span class="material-icons input-icon">email</span>
          </div>
          <div class="message error" id="email-error">
            <span class="material-icons">error</span>
            <span id="email-error-text"></span>
          </div>
        </div>
        
        <div class="form-group">
          <div class="input-wrapper">
            <input type="password" class="form-input" id="register-password" placeholder="–ü–∞—Ä–æ–ª—å" required>
            <span class="material-icons input-icon">lock</span>
            <button type="button" class="toggle-password" id="toggle-register-password">
              <span class="material-icons">visibility_off</span>
            </button>
          </div>
          <div class="message error" id="password-error">
            <span class="material-icons">error</span>
            –ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤ –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã
          </div>
        </div>
        
        <div class="form-group">
          <div class="input-wrapper">
            <input type="password" class="form-input" id="register-confirm" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
            <span class="material-icons input-icon">check_circle</span>
          </div>
          <div class="message error" id="confirm-error">
            <span class="material-icons">error</span>
            –ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç
          </div>
        </div>
        
        <div class="avatar-section">
          <div class="avatar-preview" id="avatar-preview">
            <span class="material-icons" id="avatar-icon" style="font-size: 32px; color: var(--text-secondary);">person</span>
            <img id="avatar-image" style="display: none; width: 100%; height: 100%; object-fit: cover;">
          </div>
          <button type="button" class="btn-avatar" id="btn-avatar">
            <span class="material-icons">photo_camera</span>
            –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ
          </button>
          <input type="file" id="avatar-input" accept="image/*" style="display: none;">
        </div>
        
        <button type="submit" class="btn btn-primary">
          <span class="material-icons">person_add</span>
          –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç
        </button>
      </form>
      
      <div class="form-links">
        <a href="#" class="form-link" id="link-to-login">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏</a>
      </div>
    </div>

    <!-- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è - Email -->
    <div class="form-view" id="forgot-email-view">
      <h2 class="form-title">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è</h2>
      <form id="forgot-email-form">
        <div class="form-group">
          <div class="input-wrapper">
            <input type="email" class="form-input" id="forgot-email" placeholder="–í–∞—à email" required>
            <span class="material-icons input-icon">email</span>
          </div>
          <div class="message error" id="forgot-email-error">
            <span class="material-icons">error</span>
            <span id="forgot-email-error-text"></span>
          </div>
          <div class="message success" id="forgot-email-success">
            <span class="material-icons">check_circle</span>
            –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –≤–∞—à email
          </div>
        </div>
        
        <button type="submit" class="btn btn-primary">
          <span class="material-icons">send</span>
          –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥
        </button>
      </form>
      
      <div class="demo-hint" id="demo-hint" style="display: none;">
        <strong>–î–µ–º–æ-—Ä–µ–∂–∏–º:</strong> –ö–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
      </div>
      
      <div class="form-links">
        <a href="#" class="form-link" id="link-back-to-login-from-email">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≤—Ö–æ–¥—É</a>
      </div>
    </div>

    <!-- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è - –ö–æ–¥ -->
    <div class="form-view" id="forgot-code-view">
      <h2 class="form-title">–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥</h2>
      <p style="text-align: center; color: var(--text-secondary); margin-bottom: 24px; font-size: 14px;">
        –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ <span id="user-email" style="color: var(--accent-cyan); font-weight: 600;"></span>
      </p>
      
      <form id="forgot-code-form">
        <div class="code-inputs">
          <input type="text" class="code-input" id="code-1" maxlength="1" required inputmode="numeric">
          <input type="text" class="code-input" id="code-2" maxlength="1" required inputmode="numeric">
          <input type="text" class="code-input" id="code-3" maxlength="1" required inputmode="numeric">
          <input type="text" class="code-input" id="code-4" maxlength="1" required inputmode="numeric">
          <input type="text" class="code-input" id="code-5" maxlength="1" required inputmode="numeric">
          <input type="text" class="code-input" id="code-6" maxlength="1" required inputmode="numeric">
        </div>
        
        <div class="message error" id="code-error">
          <span class="material-icons">error</span>
          –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥
        </div>
        
        <div class="timer" id="timer">
          –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ —á–µ—Ä–µ–∑: <span id="time-left">05:00</span>
        </div>
        
        <div class="resend-link">
          <button type="button" class="resend-btn" id="resend-btn" disabled>
            –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ
          </button>
        </div>
        
        <button type="submit" class="btn btn-primary">
          <span class="material-icons">check_circle</span>
          –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
        </button>
      </form>
      
      <div class="form-links">
        <a href="#" class="form-link" id="link-back-to-email">–ò–∑–º–µ–Ω–∏—Ç—å email</a>
      </div>
    </div>

    <!-- –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å -->
    <div class="form-view" id="new-password-view">
      <h2 class="form-title">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</h2>
      
      <form id="new-password-form">
        <div class="form-group">
          <div class="input-wrapper">
            <input type="password" class="form-input" id="new-password" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" required>
            <span class="material-icons input-icon">lock</span>
            <button type="button" class="toggle-password" id="toggle-new-password">
              <span class="material-icons">visibility_off</span>
            </button>
          </div>
          <div class="message error" id="new-password-error">
            <span class="material-icons">error</span>
            –ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤ –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã
          </div>
        </div>
        
        <div class="form-group">
          <div class="input-wrapper">
            <input type="password" class="form-input" id="new-password-confirm" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
            <span class="material-icons input-icon">check_circle</span>
          </div>
          <div class="message error" id="new-password-confirm-error">
            <span class="material-icons">error</span>
            –ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç
          </div>
        </div>
        
        <button type="submit" class="btn btn-primary">
          <span class="material-icons">lock_reset</span>
          –°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å
        </button>
      </form>
      
      <div class="message success" id="password-reset-success" style="display: none;">
        <span class="material-icons">check_circle</span>
        –ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω
      </div>
    </div>

    <div class="spinner" id="form-spinner"></div>
  </div>

  <!-- –ö–Ω–æ–ø–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA -->
  <button class="install-btn" id="install-btn" style="display: none;">
    <span class="material-icons">download</span>
    –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
  </button>

  <script>
    // –û—Å–Ω–æ–≤–Ω–æ–π JavaScript –º–æ–¥—É–ª—å
    (function() {
      'use strict';
      
      // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
      let resetEmail = '';
      let resetTimer = null;
      let timeLeft = 300; // 5 –º–∏–Ω—É—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
      let deferredPrompt = null;
      
      // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
      const elements = {
        views: document.querySelectorAll('.form-view'),
        spinner: document.getElementById('form-spinner'),
        installBtn: document.getElementById('install-btn'),
        codeInputs: [
          document.getElementById('code-1'),
          document.getElementById('code-2'),
          document.getElementById('code-3'),
          document.getElementById('code-4'),
          document.getElementById('code-5'),
          document.getElementById('code-6')
        ]
      };
      
      // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Ñ–æ—Ä–º
      function showView(viewId) {
        elements.views.forEach(view => {
          view.classList.remove('active');
        });
        
        const targetView = document.getElementById(viewId + '-view');
        if (targetView) {
          targetView.classList.add('active');
          hideAllMessages();
          elements.spinner.style.display = 'none';
          
          // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –Ω–∞–≤–µ—Ä—Ö –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
          if (window.innerWidth <= 480) {
            window.scrollTo(0, 0);
          }
        }
      }
      
      function hideAllMessages() {
        document.querySelectorAll('.message').forEach(msg => {
          msg.style.display = 'none';
        });
      }
      
      // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è
      function setupPasswordToggle(inputId, buttonId) {
        const input = document.getElementById(inputId);
        const button = document.getElementById(buttonId);
        
        if (!input || !button) return;
        
        button.addEventListener('click', () => {
          const isPassword = input.type === 'password';
          input.type = isPassword ? 'text' : 'password';
          button.innerHTML = `<span class="material-icons">${isPassword ? 'visibility' : 'visibility_off'}</span>`;
          button.setAttribute('aria-label', isPassword ? '–°–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å' : '–ü–æ–∫–∞–∑–∞—Ç—å –ø–∞—Ä–æ–ª—å');
        });
      }
      
      // –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞
      function setupAvatarUpload() {
        const avatarInput = document.getElementById('avatar-input');
        const avatarPreview = document.getElementById('avatar-preview');
        const avatarIcon = document.getElementById('avatar-icon');
        const avatarImage = document.getElementById('avatar-image');
        
        if (!avatarInput || !avatarPreview) return;
        
        document.getElementById('btn-avatar').addEventListener('click', () => {
          avatarInput.click();
        });
        
        avatarInput.addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (file && file.type.startsWith('image/')) {
            if (file.size > 5 * 1024 * 1024) { // 5MB –ª–∏–º–∏—Ç
              alert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5MB');
              return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
              avatarImage.src = e.target.result;
              avatarImage.style.display = 'block';
              avatarIcon.style.display = 'none';
              avatarPreview.classList.add('has-image');
              
              // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
              avatarImage.style.opacity = '0';
              avatarImage.style.transition = 'opacity 0.3s ease';
              setTimeout(() => {
                avatarImage.style.opacity = '1';
              }, 10);
            };
            reader.readAsDataURL(file);
          } else if (file) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
          }
        });
        
        // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
        avatarPreview.addEventListener('dragover', (e) => {
          e.preventDefault();
          avatarPreview.style.borderColor = 'var(--accent-cyan)';
        });
        
        avatarPreview.addEventListener('dragleave', () => {
          avatarPreview.style.borderColor = '';
        });
        
        avatarPreview.addEventListener('drop', (e) => {
          e.preventDefault();
          avatarPreview.style.borderColor = '';
          
          const file = e.dataTransfer.files[0];
          if (file && file.type.startsWith('image/')) {
            avatarInput.files = e.dataTransfer.files;
            avatarInput.dispatchEvent(new Event('change'));
          }
        });
      }
      
      // –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞–º–∏
      function setupNavigation() {
        // –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
        document.getElementById('btn-login-view').addEventListener('click', () => showView('login'));
        document.getElementById('btn-register-view').addEventListener('click', () => showView('register'));
        
        // –°—Å—ã–ª–∫–∏
        document.getElementById('link-to-register').addEventListener('click', (e) => {
          e.preventDefault();
          showView('register');
        });
        
        document.getElementById('link-to-login').addEventListener('click', (e) => {
          e.preventDefault();
          showView('login');
        });
        
        document.getElementById('link-forgot').addEventListener('click', (e) => {
          e.preventDefault();
          showView('forgot-email');
        });
        
        document.getElementById('link-back-to-login-from-email').addEventListener('click', (e) => {
          e.preventDefault();
          showView('login');
        });
        
        document.getElementById('link-back-to-email').addEventListener('click', (e) => {
          e.preventDefault();
          showView('forgot-email');
        });
        
        // –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
        document.getElementById('btn-google').addEventListener('click', () => {
          alert('–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ');
        });
        
        document.getElementById('btn-apple').addEventListener('click', () => {
          alert('–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Apple –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ');
        });
      }
      
      // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
      function setupPasswordValidation() {
        const registerConfirm = document.getElementById('register-confirm');
        const newPasswordConfirm = document.getElementById('new-password-confirm');
        
        if (registerConfirm) {
          registerConfirm.addEventListener('input', function() {
            const password = document.getElementById('register-password').value;
            const confirm = this.value;
            const error = document.getElementById('confirm-error');
            
            if (confirm && password !== confirm) {
              error.style.display = 'flex';
            } else {
              error.style.display = 'none';
            }
          });
        }
        
        if (newPasswordConfirm) {
          newPasswordConfirm.addEventListener('input', function() {
            const password = document.getElementById('new-password').value;
            const confirm = this.value;
            const error = document.getElementById('new-password-confirm-error');
            
            if (confirm && password !== confirm) {
              error.style.display = 'flex';
            } else {
              error.style.display = 'none';
            }
          });
        }
      }
      
      // –õ–æ–≥–∏–∫–∞ –≤–≤–æ–¥–∞ –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
      function setupCodeInputs() {
        elements.codeInputs.forEach((input, index) => {
          if (!input) return;
          
          input.addEventListener('input', (e) => {
            const value = e.target.value;
            
            // –û—á–∏—â–∞–µ–º –µ—Å–ª–∏ –≤–≤–µ–¥–µ–Ω –Ω–µ —Ü–∏—Ñ—Ä–æ–≤–æ–π —Å–∏–º–≤–æ–ª
            if (value && !/^\d$/.test(value)) {
              e.target.value = '';
              return;
            }
            
            // –ê–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–æ–ª—é
            if (value.length === 1 && index < elements.codeInputs.length - 1) {
              elements.codeInputs[index + 1].focus();
            }
            
            // –ê–≤—Ç–æ-–æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –≤—Å–µ—Ö –ø–æ–ª–µ–π
            if (index === elements.codeInputs.length - 1 && value.length === 1) {
              const allFilled = elements.codeInputs.every(input => input.value.length === 1);
              if (allFilled) {
                document.getElementById('forgot-code-form').dispatchEvent(new Event('submit'));
              }
            }
          });
          
          // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏—à
          input.addEventListener('keydown', (e) => {
            if (e.key === 'Backspace' && e.target.value.length === 0 && index > 0) {
              elements.codeInputs[index - 1].focus();
            }
            
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è —Å—Ç—Ä–µ–ª–∫–∞–º–∏
            if (e.key === 'ArrowLeft' && index > 0) {
              elements.codeInputs[index - 1].focus();
              e.preventDefault();
            }
            
            if (e.key === 'ArrowRight' && index < elements.codeInputs.length - 1) {
              elements.codeInputs[index + 1].focus();
              e.preventDefault();
            }
          });
          
          // –í—Å—Ç–∞–≤–∫–∞ –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞
          input.addEventListener('paste', (e) => {
            e.preventDefault();
            const pastedData = e.clipboardData.getData('text').replace(/\D/g, '');
            
            if (pastedData.length === 6) {
              pastedData.split('').forEach((char, i) => {
                if (elements.codeInputs[i]) {
                  elements.codeInputs[i].value = char;
                }
              });
              
              // –§–æ–∫—É—Å –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º –ø–æ–ª–µ
              if (elements.codeInputs[5]) {
                elements.codeInputs[5].focus();
              }
              
              // –ê–≤—Ç–æ-–æ—Ç–ø—Ä–∞–≤–∫–∞
              setTimeout(() => {
                document.getElementById('forgot-code-form').dispatchEvent(new Event('submit'));
              }, 100);
            }
          });
        });
      }
      
      // –¢–∞–π–º–µ—Ä –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞
      function startTimer() {
        clearInterval(resetTimer);
        timeLeft = 300;
        updateTimerDisplay();
        
        const timerElement = document.getElementById('timer');
        const resendBtn = document.getElementById('resend-btn');
        
        if (timerElement) timerElement.style.display = 'block';
        if (resendBtn) resendBtn.disabled = true;
        
        resetTimer = setInterval(() => {
          timeLeft--;
          updateTimerDisplay();
          
          if (timeLeft <= 0) {
            clearInterval(resetTimer);
            if (timerElement) timerElement.style.display = 'none';
            if (resendBtn) resendBtn.disabled = false;
          }
        }, 1000);
      }
      
      function updateTimerDisplay() {
        const timeLeftElement = document.getElementById('time-left');
        if (timeLeftElement) {
          const minutes = Math.floor(timeLeft / 60);
          const seconds = timeLeft % 60;
          timeLeftElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
      }
      
      // –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞
      function setupLoginForm() {
        const loginForm = document.getElementById('login-form');
        if (!loginForm) return;
        
        loginForm.addEventListener('submit', function(e) {
          e.preventDefault();
          
          const identity = document.getElementById('login-identity').value.trim();
          const password = document.getElementById('login-password').value;
          const error = document.getElementById('login-error');
          
          hideAllMessages();
          elements.spinner.style.display = 'block';
          
          if (!identity || !password) {
            elements.spinner.style.display = 'none';
            error.style.display = 'flex';
            return;
          }
          
          setTimeout(() => {
            try {
              const user = UserSystem.login(identity, password);
              
              if (user) {
                // –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥
                elements.spinner.style.display = 'block';
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–µ—Å—Å–∏—é
                localStorage.setItem('last_login', new Date().toISOString());
                
                // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                setTimeout(() => {
                  window.location.href = 'map.html';
                }, 800);
              } else {
                elements.spinner.style.display = 'none';
                error.style.display = 'flex';
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –æ—à–∏–±–∫–∏
                loginForm.classList.add('shake');
                setTimeout(() => {
                  loginForm.classList.remove('shake');
                }, 500);
              }
            } catch (error) {
              console.error('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', error);
              elements.spinner.style.display = 'none';
              document.getElementById('login-error').style.display = 'flex';
            }
          }, 500);
        });
      }
      
      // –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
      function setupRegisterForm() {
        const registerForm = document.getElementById('register-form');
        if (!registerForm) return;
        
        registerForm.addEventListener('submit', async function(e) {
          e.preventDefault();
          
          const nickname = document.getElementById('register-nickname').value.trim();
          const email = document.getElementById('register-email').value.trim().toLowerCase();
          const password = document.getElementById('register-password').value;
          const confirm = document.getElementById('register-confirm').value;
          
          hideAllMessages();
          
          let hasErrors = false;
          
          // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∏–∫–Ω–µ–π–º–∞
          const nicknameError = document.getElementById('nickname-error');
          if (!nickname) {
            document.getElementById('nickname-error-text').textContent = '–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º';
            nicknameError.style.display = 'flex';
            hasErrors = true;
          } else if (nickname.length < 3) {
            document.getElementById('nickname-error-text').textContent = '–ù–∏–∫–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 3 —Å–∏–º–≤–æ–ª–æ–≤';
            nicknameError.style.display = 'flex';
            hasErrors = true;
          } else if (UserSystem.isNicknameUsed(nickname)) {
            document.getElementById('nickname-error-text').textContent = '–ù–∏–∫–Ω–µ–π–º —É–∂–µ –∑–∞–Ω—è—Ç';
            nicknameError.style.display = 'flex';
            hasErrors = true;
          }
          
          // –í–∞–ª–∏–¥–∞—Ü–∏—è email
          const emailError = document.getElementById('email-error');
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          
          if (!email) {
            document.getElementById('email-error-text').textContent = '–í–≤–µ–¥–∏—Ç–µ email';
            emailError.style.display = 'flex';
            hasErrors = true;
          } else if (!emailRegex.test(email)) {
            document.getElementById('email-error-text').textContent = '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email';
            emailError.style.display = 'flex';
            hasErrors = true;
          } else if (UserSystem.isEmailUsed(email)) {
            document.getElementById('email-error-text').textContent = 'Email —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è';
            emailError.style.display = 'flex';
            hasErrors = true;
          }
          
          // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è
          const passwordError = document.getElementById('password-error');
          if (!password || password.length < 8) {
            passwordError.textContent = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤';
            passwordError.style.display = 'flex';
            hasErrors = true;
          } else if (!/[a-zA-Z]/.test(password)) {
            passwordError.textContent = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –±—É–∫–≤—ã';
            passwordError.style.display = 'flex';
            hasErrors = true;
          } else if (!/\d/.test(password)) {
            passwordError.textContent = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ü–∏—Ñ—Ä—ã';
            passwordError.style.display = 'flex';
            hasErrors = true;
          }
          
          // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
          if (password !== confirm) {
            document.getElementById('confirm-error').style.display = 'flex';
            hasErrors = true;
          }
          
          if (hasErrors) return;
          
          // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          elements.spinner.style.display = 'block';
          
          try {
            let avatarData = '';
            const avatarFile = document.getElementById('avatar-input').files[0];
            if (avatarFile) {
              avatarData = await UserSystem.fileToBase64(avatarFile);
            }
            
            const newUser = {
              email: email,
              nickname: nickname,
              password: password,
              avatar: avatarData,
              position: [55.751244, 37.618423],
              registeredAt: new Date().toISOString()
            };
            
            const createdUser = UserSystem.createUser(newUser);
            
            if (createdUser) {
              UserSystem.setCurrentUser(createdUser);
              
              // –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
              localStorage.setItem('user_registered', 'true');
              localStorage.setItem('registration_date', new Date().toISOString());
              
              setTimeout(() => {
                window.location.href = 'map.html';
              }, 1000);
            } else {
              throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
            }
            
          } catch (error) {
            elements.spinner.style.display = 'none';
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + error.message);
            console.error('Registration error:', error);
          }
        });
      }
      
      // –§–æ—Ä–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
      function setupForgotPasswordForms() {
        // –§–æ—Ä–º–∞ email
        const forgotEmailForm = document.getElementById('forgot-email-form');
        if (forgotEmailForm) {
          forgotEmailForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('forgot-email').value.trim().toLowerCase();
            const error = document.getElementById('forgot-email-error');
            const success = document.getElementById('forgot-email-success');
            const demoHint = document.getElementById('demo-hint');
            
            hideAllMessages();
            
            if (!email) {
              document.getElementById('forgot-email-error-text').textContent = '–í–≤–µ–¥–∏—Ç–µ email';
              error.style.display = 'flex';
              return;
            }
            
            const user = UserSystem.findUser(email);
            if (!user) {
              document.getElementById('forgot-email-error-text').textContent = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email –Ω–µ –Ω–∞–π–¥–µ–Ω';
              error.style.display = 'flex';
              return;
            }
            
            elements.spinner.style.display = 'block';
            
            try {
              // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–¥
              const resetCode = Math.floor(100000 + Math.random() * 900000).toString();
              
              // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–¥
              localStorage.setItem('reset_code_' + email, resetCode);
              localStorage.setItem('reset_email', email);
              
              // –ò–º–∏—Ç–∏—Ä—É–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É
              await new Promise(resolve => setTimeout(resolve, 1200));
              
              resetEmail = email;
              
              elements.spinner.style.display = 'none';
              success.style.display = 'flex';
              demoHint.style.display = 'block';
              
              // –î–µ–º–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
              console.log('üîê –î–µ–º–æ-—Ä–µ–∂–∏–º: –ö–æ–¥ –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è:', resetCode);
              console.log('üìß Email:', email);
              
              setTimeout(() => {
                document.getElementById('user-email').textContent = email;
                showView('forgot-code');
                startTimer();
              }, 1500);
              
            } catch (error) {
              elements.spinner.style.display = 'none';
              document.getElementById('forgot-email-error-text').textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–¥–∞';
              error.style.display = 'flex';
            }
          });
        }
        
        // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞
        const resendBtn = document.getElementById('resend-btn');
        if (resendBtn) {
          resendBtn.addEventListener('click', async function() {
            if (!resetEmail) return;
            
            this.disabled = true;
            document.getElementById('timer').style.display = 'block';
            elements.spinner.style.display = 'block';
            
            try {
              const resetCode = Math.floor(100000 + Math.random() * 900000).toString();
              localStorage.setItem('reset_code_' + resetEmail, resetCode);
              
              await new Promise(resolve => setTimeout(resolve, 1200));
              
              console.log('üîê –î–µ–º–æ-—Ä–µ–∂–∏–º: –ù–æ–≤—ã–π –∫–æ–¥:', resetCode);
              console.log('üìß Email:', resetEmail);
              
              startTimer();
            } catch (error) {
              console.error('Error resending code:', error);
            } finally {
              elements.spinner.style.display = 'none';
            }
          });
        }
        
        // –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ –∫–æ–¥–∞
        const forgotCodeForm = document.getElementById('forgot-code-form');
        if (forgotCodeForm) {
          forgotCodeForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const code = elements.codeInputs.map(input => input.value).join('');
            const error = document.getElementById('code-error');
            
            hideAllMessages();
            
            if (code.length !== 6) {
              error.style.display = 'flex';
              return;
            }
            
            const savedCode = localStorage.getItem('reset_code_' + resetEmail);
            if (savedCode === code) {
              showView('new-password');
            } else {
              error.style.display = 'flex';
              
              // –ê–Ω–∏–º–∞—Ü–∏—è –æ—à–∏–±–∫–∏
              elements.codeInputs.forEach(input => {
                input.style.borderColor = 'var(--border-error)';
                setTimeout(() => {
                  input.style.borderColor = '';
                }, 1000);
              });
            }
          });
        }
        
        // –§–æ—Ä–º–∞ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è
        const newPasswordForm = document.getElementById('new-password-form');
        if (newPasswordForm) {
          newPasswordForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const code = elements.codeInputs.map(input => input.value).join('');
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('new-password-confirm').value;
            
            hideAllMessages();
            
            let hasErrors = false;
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è
            const passwordError = document.getElementById('new-password-error');
            if (!newPassword || newPassword.length < 8) {
              passwordError.textContent = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤';
              passwordError.style.display = 'flex';
              hasErrors = true;
            } else if (!/[a-zA-Z]/.test(newPassword)) {
              passwordError.textContent = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –±—É–∫–≤—ã';
              passwordError.style.display = 'flex';
              hasErrors = true;
            } else if (!/\d/.test(newPassword)) {
              passwordError.textContent = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ü–∏—Ñ—Ä—ã';
              passwordError.style.display = 'flex';
              hasErrors = true;
            }
            
            // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
            if (newPassword !== confirmPassword) {
              document.getElementById('new-password-confirm-error').style.display = 'flex';
              hasErrors = true;
            }
            
            if (hasErrors) return;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
            const savedCode = localStorage.getItem('reset_code_' + resetEmail);
            if (savedCode !== code) {
              document.getElementById('code-error').style.display = 'flex';
              return;
            }
            
            elements.spinner.style.display = 'block';
            
            try {
              const users = UserSystem.getUsers();
              const userIndex = users.findIndex(u => u.email === resetEmail.toLowerCase());
              
              if (userIndex !== -1) {
                users[userIndex].password = UserSystem.hashPassword(newPassword);
                users[userIndex].updatedAt = new Date().toISOString();
                UserSystem.saveUsers(users);
                
                // –û—á–∏—Å—Ç–∫–∞
                localStorage.removeItem('reset_code_' + resetEmail);
                localStorage.removeItem('reset_email');
                elements.codeInputs.forEach(input => input.value = '');
                document.getElementById('new-password').value = '';
                document.getElementById('new-password-confirm').value = '';
                
                elements.spinner.style.display = 'none';
                document.getElementById('password-reset-success').style.display = 'flex';
                
                setTimeout(() => {
                  showView('login');
                  resetEmail = '';
                }, 2000);
              } else {
                throw new Error('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
              }
            } catch (error) {
              elements.spinner.style.display = 'none';
              document.getElementById('code-error').style.display = 'flex';
              console.error('Password reset error:', error);
            }
          });
        }
      }
      
      // PWA —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
      function setupPWA() {
        // Service Worker
        if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
            navigator.serviceWorker.register('/service-worker.js')
              .then(registration => {
                console.log('‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration.scope);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
                registration.addEventListener('updatefound', () => {
                  console.log('üîÑ –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Service Worker');
                });
              })
              .catch(error => {
                console.log('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', error);
              });
          });
        }
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PWA
        window.addEventListener('beforeinstallprompt', (e) => {
          e.preventDefault();
          deferredPrompt = e;
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏
          elements.installBtn.style.display = 'flex';
          
          elements.installBtn.addEventListener('click', async () => {
            if (!deferredPrompt) return;
            
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            
            console.log(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${outcome === 'accepted' ? '–ø—Ä–∏–Ω—è–ª' : '–æ—Ç–∫–ª–æ–Ω–∏–ª'} —É—Å—Ç–∞–Ω–æ–≤–∫—É`);
            
            deferredPrompt = null;
            elements.installBtn.style.display = 'none';
          });
        });
        
        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
        window.addEventListener('appinstalled', () => {
          console.log('‚úÖ PWA —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
          elements.installBtn.style.display = 'none';
          deferredPrompt = null;
        });
      }
      
      // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤–æ–º –ø–æ–ª–µ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ñ–æ—Ä–º
      function setupAutoFocus() {
        const observer = new MutationObserver((mutations) => {
          mutations.forEach((mutation) => {
            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
              const activeView = document.querySelector('.form-view.active');
              if (activeView) {
                const firstInput = activeView.querySelector('input:not([type="file"]):not([type="hidden"])');
                if (firstInput) {
                  setTimeout(() => {
                    firstInput.focus();
                  }, 100);
                }
              }
            }
          });
        });
        
        elements.views.forEach(view => {
          observer.observe(view, { attributes: true });
        });
      }
      
      // –û—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º
      function setupOfflineDetection() {
        window.addEventListener('online', () => {
          console.log('‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
        });
        
        window.addEventListener('offline', () => {
          console.log('‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ');
        });
      }
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
      function init() {
        console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ö–∞—Ä—Ç–∞ –¥—Ä—É–∑–µ–π');
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
        setupNavigation();
        setupPasswordToggle('login-password', 'toggle-login-password');
        setupPasswordToggle('register-password', 'toggle-register-password');
        setupPasswordToggle('new-password', 'toggle-new-password');
        setupAvatarUpload();
        setupPasswordValidation();
        setupCodeInputs();
        setupLoginForm();
        setupRegisterForm();
        setupForgotPasswordForms();
        setupPWA();
        setupAutoFocus();
        setupOfflineDetection();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–π–º–µ—Ä–∞
        document.getElementById('timer').style.display = 'block';
        document.getElementById('resend-btn').disabled = true;
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏
        const lastLogin = localStorage.getItem('last_login');
        if (lastLogin) {
          const lastLoginDate = new Date(lastLogin);
          const now = new Date();
          const hoursDiff = (now - lastLoginDate) / (1000 * 60 * 60);
          
          if (hoursDiff < 24) {
            console.log('üîÑ –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥ –±—ã–ª:', lastLoginDate.toLocaleString());
          }
        }
        
        console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
      }
      
      // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
      
      // –≠–∫—Å–ø–æ—Ä—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
      window.App = {
        showView,
        hideAllMessages,
        startTimer,
        updateTimerDisplay
      };
    })();
  </script>
</body>
</html>
